<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8" />

  <!-- mobile responsive meta -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>웹성능 최적화 - DataURI</title>
  <meta
    name="description"
    content="웹퍼블리셔 정혜인 개인 포트폴리오"
  />

  <link rel="canonical" href="https://henyy1004.github.io/2020/01/22/DataURI/" />
  <link rel="alternate" type="application/rss+xml" title="Jung Hyein – Portfolio" href="/feed.xml">
    <!-- Fonts -->
    <link
      media="none"
      href="https://fonts.googleapis.com/css?family=Lora:400,400i,700&display=swap"
      rel="stylesheet"
      onload="this.media='all'"
    />
    <link
    media="none"
      href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono&display=swap"
      rel="stylesheet"
      onload="this.media='all'"
    />
    <link
    media="none"
      href="https://fonts.googleapis.com/css?family=Noto+Serif+KR&display=swap"
      rel="stylesheet"
      onload="this.media='all'"
    />

  <!-- Main Stylesheet -->
  <link href="/assets/css/main.css" rel="stylesheet" />
</head>


<body>

  

  <div class="container-full">
  <!-- begin header -->
  <header class="header">

    <div class="logo">
      <a class="logo__link" href="/">
      
        Hyein Portfolio
      
      </a>
    </div>

    <nav class="main-nav">
      <span class="main-nav__open">menu</span>

      <div class="main-nav__box">
        <span class="main-nav__close">Close</span>

        <ul class="nav__list list-reset">
          <li class="nav__item">
            <a href="/" class="nav__link">Home</a>
          </li>
          
            
          
            
          
          <li class="nav__item">
            <a href="/about/" class="nav__link">About</a>
          </li>
          
            
          
            
          
            
          
            
          
            
          
            
          
          <li class="nav__item">
            <a href="/post/" class="nav__link">Post</a>
          </li>
          
            
          
            
          
          <li class="nav__item">
            <a href="/resume/" class="nav__link">Resume</a>
          </li>
          
            
          
            
          
          <li class="nav__item">
            <a href="/works/" class="nav__link">Works</a>
          </li>
          
            
          
            
          
            
          
            
          
            
          
        </ul>

      </div>

    </nav>

  </header>
  <!-- end header -->
</div>


  <!-- begin content -->
  <main class="content" aria-label="Content">
    <div class="container">
  <!-- begin post -->
  <article class="post">
    <div
      class="post__head"
      data-aos="fade-up"
      data-aos-easing="ease-out-quad"
      data-aos-duration="700"
    >
      <h1 class="post__title">웹성능 최적화 - DataURI</h1>
      <div class="post__date">
        <time datetime="2020-01-22T00:05:55+09:00"
          >Published Jan 22, 2020</time
        >
      </div>
      
    </div>

    <div
      class="post__content"
      data-aos="fade-up"
      data-aos-easing="ease-out-quad"
      data-aos-delay="100"
      data-aos-duration="700"
    >
      <h2 id="datauri">DataURI</h2>
<p>Data URI는 파일을 나타내는 base64로 인코딩 된 문자열이다.
파일 내용을 문자열로 가져 오면 HTML 또는 CSS 코드에 데이터를 직접 포함 할 수 있다. 브라우저가 코드에서 데이터 URI를 발견하면 데이터를 디코딩하고 원본 파일을 구성 할 수 있다.</p>

<p>폰트, 동영상 등 여러 리소스에서 Data URI를 사용할 수 있지만 이미지에서 주로 많이 사용 된다.</p>

<p>DataURI로 리소스를 가져오게 되면 HTTP요청이 줄어들어 웹 성능 최적화에 도움이 된다. 때문에 웹 성능 최적화를 하는 방법 중 하나로 사용되고 있다.</p>

<h2 id="syntax">Syntax</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;
</code></pre></div></div>

<h3 id="html-이미지태그-사용-예시">html 이미지태그 사용 예시</h3>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"data:image/jpeg;base64,/9j/4QvXRXhpZgAASUkqAAgAAAAMAAABAwABAAAA6AMAAAEBAwABAAAA6AMAAAIBAwADAAAAngAAAAYBAwABAAAAAgAAABIBAwABAAAAAQAAABUBAwABAAAAAwAAABoBBQABAAAApAAAABsBBQABAAAArAAAACgBAwABAAAAAgAAADEBAgAkAAAAtAAAADIBAgAUAAAA2AAAAGmHBAABAAAA7AAAACQBAAAIAAgACACA/..."</span> <span class="na">alt=</span><span class="s">""</span><span class="nt">&gt;</span>
</code></pre></div></div>
<h3 id="css-background-사용-예시">css background 사용 예시</h3>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">li</span> <span class="p">{</span> 
    <span class="nl">background</span><span class="p">:</span> <span class="sx">url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABFCAYAAAD6pOBtAAAABmJLR0QA/wD/AP...)</span> <span class="nb">no-repeat</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="장점">장점</h2>
<ul>
  <li>HTTP 요청 수를 줄일 수 있음
    <ul>
      <li>(새로운 HTTP요청을 생성 -&gt; 단일 HTTP요청을 많은 데이터양 다운 &lt; 여러 HTTP요청으로 동일한 데이터양 다운(이게 빠르다))</li>
    </ul>
  </li>
</ul>

<h2 id="단점">단점</h2>
<ul>
  <li>크기가 30%정도 증가한다</li>
  <li>HTML내에 삽입한 경우 긴 DataURI text로 인해 파싱시간이 오래걸린다.</li>
  <li>브라우저에서 캐시하지 않는다.(브라우저가 로드할때마다 디코딩 작업을 거친다-&gt;CPU 소비)</li>
  <li>모바일 브라우저에서는 DataURI 디코딩 속도가 6배나 느리다.</li>
</ul>

<h2 id="크로스브라우징">크로스브라우징</h2>
<ul>
  <li>IE8이상</li>
  <li>안드로이드 2.1이상</li>
</ul>

<h2 id="이미지-파일-vs-datauri">이미지 파일 vs DataURI</h2>
<p>최근 면접을 다녀오며 이부분에 대한 질문을 들은적 있다.</p>
<ul>
  <li>이미지파일, 이미지태그에 DataURI, css에  DataURI를 background로 적용 했을때 이미지렌더링이 제일 빠른 방법은?</li>
  <li>이미지태그에 DataURI, css에  DataURI를 background로 적용 했을때 이미지렌더링이 제일 빠른 방법은?</li>
</ul>

<p>DataURI를 사용했을때 장점과 단점정도는 알고 있었으나 실제로 어떻게 될지 생각해본적이 없었다. 이 질문에 대해 답변을 제대로 못한게 너무 실망스러워 실제로 테스트해보기로 했다.</p>

<h2 id="작은-이미지4kb를-사용한-비교">작은 이미지(4KB)를 사용한 비교</h2>
<h3 id="1html-img태그-jpg파일">1.html img태그 jpg파일</h3>
<p><img src="/assets/img/post/datauri_img.png" alt="dataURI jpg file" /></p>
<h3 id="2html-img태그-datauri-적용">2.html img태그 dataURI 적용</h3>
<p><img src="/assets/img/post/datauri_html.png" alt="dataURI html" /></p>
<h3 id="3html-img태그-datauri-적용">3.html img태그 dataURI 적용</h3>
<p><img src="/assets/img/post/datauri_css.png" alt="dataURI html" /></p>

<p>4KB의 작은 이미지 파일로 적용했을때 3가지 방법의 <code class="highlighter-rouge">DOMContentLoaded</code>와 <code class="highlighter-rouge">Load</code>시간은 크게 차이나지 않았다. 평균을 내보았을때 아주아주 미세한 차이를 가졌고(.5ms정도) <code class="highlighter-rouge">1 &gt; 3 &gt; 2</code> 의 순서로 빨랐다. 또한 <code class="highlighter-rouge">2</code>의 경우 적은 용량이다보니 파싱이 빨라 css보다 이미지를 빨리 가져왔다. html내의 코드이기 때문에 파싱을 이미지를 받을 수 있었던 것 같다.(틀렸으면 알려주세요)</p>

<h2 id="큰-이미지800kb를-사용한-비교">큰 이미지(800KB)를 사용한 비교</h2>
<h3 id="1html-img태그-jpg파일-1">1.html img태그 jpg파일</h3>
<p><img src="/assets/img/post/datauri_img2.png" alt="dataURI jpg file" /></p>
<h3 id="2html-img태그-datauri-적용-1">2.html img태그 dataURI 적용</h3>
<p><img src="/assets/img/post/datauri_html2.png" alt="dataURI html" /></p>
<h3 id="3html-img태그-datauri-적용-1">3.html img태그 dataURI 적용</h3>
<p><img src="/assets/img/post/datauri_css2.png" alt="dataURI html" /></p>

<p>800KB의 큰 이미지 파일로 적용했을때 3가지 방법의 <code class="highlighter-rouge">DOMContentLoaded</code>와 <code class="highlighter-rouge">Load</code>시간은 매우 큰 차이를 보였다.
평균적으로는 <code class="highlighter-rouge">1 &gt; 3 &gt; 2</code>의 순서로 빨랐다.
<code class="highlighter-rouge">2</code>의 경우 4KB의 적은 용량과는 다르게 css파일보다 한참 뒤에 이미지를 가져왔다. dataURI의 코드가 너무길어 파싱하는 시간이 지연됐기 때문에
css가 먼저 다운로드 된 것 같다(틀렸으면 알려주세요)</p>

<h2 id="결과">결과</h2>

<p><code class="highlighter-rouge">DOMContentLoaded</code>는 브라우저가 HTML파일을 다운받고 <code class="highlighter-rouge">DOM</code>을 완성한 시점이고 <code class="highlighter-rouge">Load</code>는 <code class="highlighter-rouge">DOM</code>이 완성되고 <code class="highlighter-rouge">CSS</code>,<code class="highlighter-rouge">js</code>,<code class="highlighter-rouge">이미지</code> 리소스들이 모두 다운로드 된 시점이다. 이 시점이 빠를수록 웹 브라우저의 렌더링은 빠르게 진행되고, 웹 성능은 향상된다.</p>

<p>결과적으로는 <code class="highlighter-rouge">1번인 이미지파일을 img태그로 불러왔을 때</code> 가장 빨랐다.
다만 내가 진행한 테스트는 아주 적은 용량의 문서와 이미지만을 가지고 한 테스트다.
파일의 용량, 네트워크의 환경 등 여러가지로 인해 결과는 달라질 수 있다.</p>

<h2 id="공통적인-부분">공통적인 부분</h2>
<p><code class="highlighter-rouge">2</code>의 경우 html문서 내에 dataURI를 적용했을 때
HTML의 파싱시간이 굉장히 오래걸린다. 이유는 dataURI코드가 굉장히 길기때문이다. 특히 용량이 크면 클수록 코드는 굉장히 길어진다. 또한 이 코드를 해석하는데 CPU가 사용된다. 파싱이 지연되면 렌더링이 늦어진다.</p>

<p><code class="highlighter-rouge">dataURI</code>를 사용한 이미지 리소스를 보면 <code class="highlighter-rouge">Size</code>에 <code class="highlighter-rouge">memory cache</code>라고 쓰여져 있으며 <code class="highlighter-rouge">Time</code>이 이미지 파일보다 세배이상 빠른걸 볼 수 있다.</p>

<p>웹 브라우저는 css, js, 이미지를 저장할때 두개의 브라우저 캐시에 저장하는데 <code class="highlighter-rouge">memory</code>와 <code class="highlighter-rouge">disk</code>가 있다.</p>

<ul>
  <li><code class="highlighter-rouge">memory cache</code> : CPU에 저장하는 캐시로 속도는 굉장히 빠르지만 적은 용량을 저장한다.</li>
  <li><code class="highlighter-rouge">disk cache</code> : RAM에 저장하는 캐시로 큰 용량을 저장할 수 있지만 속도가 느리다.</li>
</ul>

<p><code class="highlighter-rouge">dataURI</code>는 <code class="highlighter-rouge">memory cache</code>에 저장되기 때문에 빨리 로드되는 것 같다.</p>

<h2 id="결론">결론</h2>
<p>dataURI는 HTML이 파싱되며 디코딩된다. 또한 <code class="highlighter-rouge">memory cache</code> 따라서 이미지파일 보다는 이미지를 빨리 가져오는 것 같다.
단순히 이미지 로딩의 속도면으로만 본다면 작은 사이즈의 이미지일떄는 dataURI를 사용해도 좋을 것 같다. 다만 코드가 너무 길기때문에 파일구분이 힘들고 파싱이 오래걸린다는 점을 잘 체크하고 적용해야될 것 같다.</p>

<p>개인적으로 큰 이미지파일은 뭔가 배보다 배꼽이 더 큰것같은 느낌이 든다.(비추한다는 얘기)</p>

<p>테스트는 아주 단순한 방법으로 진행하여 차이는 크게 나지 않았지만 수많은 외부 리소스들과 코드들이 많은 페이지에서 dataURI의 사용은 웹 성능향상에  상당히 도움이 될 것 같다.</p>

<p>또한 css background 속성에 dataURI를 사용할 경우 <code class="highlighter-rouge">SEO</code>를 생각해야 된다. 검색엔진은 background 속성의 이미지를 검색하지 못한다. 요즘은 <code class="highlighter-rouge">구글 이미지검색</code>이 많이 사용되고 있으며 웹페이지의 검색대상이 되는 이미지를 이미지 태그로 삽입해야된다.</p>

<p>용량같은 경우는 압축프로그램을 사용하여 압축을 할 수 있다.
또한 <code class="highlighter-rouge">webpack</code>같은 프로그램으로 몇키로바이트 미만의 파일은 dataURI를 사용하고 그 이상은 사용하지 않게 하도록 자동화 빌드해주는 시스템도 있다.
어떤 목적으로 사용해야되는데 단점이 있으면 그걸 해결하는 방법을 찾으며 적용하여 쓸 수 있단 말이다. 무조건 쓰면 안된다,좋다가 아니라 어떤 목적으로, 왜, 어떻게 사용해야 되는지, 어떤 방법을 써서 적용을 할지가 중요한 것 같다.(계획,분석의 중요성)</p>

<p>사실 적용해보며 어떤게 확 좋다는 생각은 크게 들지 않았지만
dataURI를 공부하면서 브라우저 작동 원리에 대해 좀 더 깊이 공부할 수 있었던 것 같다.</p>

<h2 id="궁금한점숙제">궁금한점(숙제)</h2>
<ul>
  <li>dataURI의 장점은 서버에 요청하지 않는다고 하는데 request는 img와 동일하다 왜일까</li>
  <li>dataURI는 캐시되지 않는다 했는데 <code class="highlighter-rouge">memory cache</code>에서 온다. 혼란스럽다.(css는 캐시가 된다 = css dataURI는 캐시가 된다)</li>
  <li>이미지 파일은 <code class="highlighter-rouge">disk chache</code>에 저장되는가?</li>
</ul>

    </div>

    

    <!-- <div class="post__share">
      <ul class="share__list list-reset">
        <li class="share__item">
          <a
            class="share__link share__facebook"
            href="https://www.facebook.com/sharer/sharer.php?u=https://henyy1004.github.io/2020/01/22/DataURI/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Facebook"
            rel="nofollow"
          >
            <svg
              enable-background="new 0 0 56.693 56.693"
              height="56.693"
              viewBox="0 0 56.693 56.693"
              width="56.693"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="m40.43 21.739h-7.645v-5.014c0-1.883 1.248-2.322 2.127-2.322h5.395v-8.278l-7.43-.029c-8.248 0-10.125 6.174-10.125 10.125v5.518h-4.77v8.53h4.77v24.137h10.033s0-13.32 0-24.137h6.77z"
              />
            </svg>
          </a>
        </li>

        <li class="share__item">
          <a
            class="share__link share__twitter"
            href="https://twitter.com/intent/tweet?text=%EC%9B%B9%EC%84%B1%EB%8A%A5%20%EC%B5%9C%EC%A0%81%ED%99%94%20-%20DataURI&url=https://henyy1004.github.io/2020/01/22/DataURI/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Twitter"
            rel="nofollow"
          >
            <svg
              enable-background="new 0 0 56.693 56.693"
              height="56.693"
              viewBox="0 0 56.693 56.693"
              width="56.693"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="m52.837 15.065c-1.811.805-3.76 1.348-5.805 1.591 2.088-1.25 3.689-3.23 4.444-5.592-1.953 1.159-4.115 2-6.418 2.454-1.843-1.964-4.47-3.192-7.377-3.192-5.581 0-10.106 4.525-10.106 10.107 0 .791.089 1.562.262 2.303-8.4-.422-15.848-4.445-20.833-10.56-.87 1.492-1.368 3.228-1.368 5.082 0 3.506 1.784 6.6 4.496 8.412-1.656-.053-3.215-.508-4.578-1.265-.001.042-.001.085-.001.128 0 4.896 3.484 8.98 8.108 9.91-.848.23-1.741.354-2.663.354-.652 0-1.285-.063-1.902-.182 1.287 4.015 5.019 6.938 9.441 7.019-3.459 2.711-7.816 4.327-12.552 4.327-.815 0-1.62-.048-2.411-.142 4.474 2.869 9.786 4.541 15.493 4.541 18.591 0 28.756-15.4 28.756-28.756 0-.438-.009-.875-.028-1.309 1.974-1.422 3.688-3.203 5.042-5.23z"
              />
            </svg>
          </a>
        </li>

        <li class="share__item">
          <a
            class="share__link share__pinterest"
            href="http://pinterest.com/pin/create/button/?url=https://henyy1004.github.io/2020/01/22/DataURI/&amp;media=https://henyy1004.github.io&amp;description=%EC%9B%B9%EC%84%B1%EB%8A%A5%20%EC%B5%9C%EC%A0%81%ED%99%94%20-%20DataURI"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Pinterest"
            rel="nofollow"
          >
            <svg
              enable-background="new 0 0 56.693 56.693"
              height="56.693"
              viewBox="0 0 56.693 56.693"
              width="56.693"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="m28.348 5.158c-13.599 0-24.625 11.023-24.625 24.625 0 10.082 6.063 18.744 14.739 22.553-.069-1.721-.012-3.783.429-5.654.473-2 3.168-13.418 3.168-13.418s-.787-1.572-.787-3.896c0-3.648 2.115-6.373 4.749-6.373 2.24 0 3.322 1.682 3.322 3.695 0 2.252-1.437 5.619-2.175 8.738-.616 2.613 1.31 4.744 3.887 4.744 4.665 0 7.808-5.992 7.808-13.092 0-5.397-3.635-9.437-10.246-9.437-7.47 0-12.123 5.57-12.123 11.792 0 2.146.633 3.658 1.624 4.83.455.537.519.754.354 1.371-.118.453-.389 1.545-.501 1.977-.164.625-.669.848-1.233.617-3.44-1.404-5.043-5.172-5.043-9.408 0-6.994 5.899-15.382 17.599-15.382 9.4 0 15.588 6.804 15.588 14.107 0 9.658-5.369 16.875-13.285 16.875-2.659 0-5.16-1.438-6.016-3.068 0 0-1.43 5.674-1.732 6.768-.522 1.9-1.545 3.797-2.479 5.275 2.215.654 4.554 1.01 6.979 1.01 13.598 0 24.623-11.023 24.623-24.623-.001-13.603-11.027-24.626-24.624-24.626z"
              />
            </svg>
          </a>
        </li>
      </ul>
    </div> -->

    <div class="post__navigation">
      
      <a class="prev" href="/2020/01/13/crossBrowsing/">
        <div class="prev__post-icon">
          <svg
            enable-background="new 0 0 512 512"
            height="512"
            viewBox="0 0 512 512"
            width="512"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="m352 128.4-32.3-32.4-159.7 160 159.7 160 32.3-32.4-127.3-127.6z" />
          </svg>
        </div>
        <span class="post__nav-wrapper">
          <div
            class="post__nav-image"
            style="background-image: url()"
          ></div>
          <h2 class="post__nav-title">
            <time datetime="2020-01-22T00:05:55+09:00"
              >Jan 22, 2020</time
            >
            <br />크로스브라우징
          </h2>
        </span>
      </a>
       
    </div>
    <!-- 
    
      <div class="show-comments">
    <button class="disqus-button" id="show-comments-button" onclick="disqus();return false;">Leave a comment</button>
</div>

<div id="disqus_thread"></div>

<script>
var disqus_loaded = false;
var disqus_shortname = 'Hyein'; // Add your shortname here
function disqus() {
  if (!disqus_loaded)  {
      disqus_loaded = true;
      var e = document.createElement("script");
      e.type = "text/javascript";
      e.async = true;
      e.src = "//" + disqus_shortname + ".disqus.com/embed.js";
      (document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0])
      .appendChild(e);
      // Hide the button after opening
      document.getElementById("show-comments-button").style.display = "none";
  }
}
</script>
<noscript>Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

     -->
  </article>
  <!-- end post -->
</div>

  </main>
  <!-- end content -->

  <div class="container">
  <!-- begin footer -->
  <footer class="footer">
    <div class="footer__inner">
      <div class="contact">
        <div class="contact__title">
          Work inquiry, question or something else?
          <a href="mailto:junghi0327@gmail.com" target="_blank">Email me</a>.
        </div>
        <ul class="contact__list list-reset">
          
          <li class="contact__item">
            <a class="contact__link" href="https://twitter.com/">Twitter</a>
          </li>
          
          <li class="contact__item">
            <a class="contact__link" href="https://facebook.com/">Facebook</a>
          </li>
          
          <li class="contact__item">
            <a class="contact__link" href="https://instagram.com/">Instagram</a>
          </li>
          
        </ul>
      </div>
    </div>
  </footer>
  <!-- end footer -->
</div>


  <!-- begin js -->
  <script src="/assets/js/vendors/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/vendors/aos.js"></script>
  <script src="/assets/js/vendors/jquery.fitvids.js"></script>
  <script src="/assets/js/common.js"></script>
  
  <!-- end js -->
</body>

</html>
